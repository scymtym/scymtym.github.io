<!DOCTYPE html><html><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="style.css"/><script src="permalink.js"> </script><script src="navigation.js"> </script><script src="search-data.js"> </script><script src="search.js"> </script><title>second-cluffer User's Manual</title></head><body><main><nav class="sidebar"><span class="name">Search</span><br/><input id="search" type="search" placeholder="type to search"/><ol id="results"> </ol><hr/><span class="name">second-cluffer User's Manual</span><br/><ol class="local-toc"><li><a href="#1-introduction">1 Introduction</a><ol> </ol></li><li><a href="#2-external-protocols">2 External Protocols</a><ol> <li><a href="#2.1-packages">2.1 Packages</a><ol> </ol></li><li><a href="#2.2-conditions">2.2 Conditions</a><ol> </ol></li><li><a href="#2.3-protocol-classes">2.3 Protocol Classes</a><ol> </ol></li><li><a href="#2.4-location-comparison-protocol">2.4 Location Comparison Protocol</a><ol> </ol></li><li><a href="#2.5-item-container-protocol">2.5 Item Container Protocol</a><ol> </ol></li><li><a href="#2.6-line-number-protocol">2.6 Line Number Protocol</a><ol> </ol></li><li><a href="#2.7-line-link-protocol">2.7 Line Link Protocol</a><ol> </ol></li><li><a href="#2.8-buffer-link-protocol">2.8 Buffer Link Protocol</a><ol> </ol></li><li><a href="#2.9-cursor-protocol">2.9 Cursor Protocol</a><ol> <li><a href="#2.9.1-cursor-attachment">2.9.1 Cursor Attachment</a><ol> </ol></li><li><a href="#2.9.2-cursor-location">2.9.2 Cursor Location</a><ol> </ol></li><li><a href="#2.9.3-cursor-movement">2.9.3 Cursor Movement</a><ol> </ol></li><li><a href="#2.9.4-cursor-items">2.9.4 Cursor Items</a><ol> </ol></li></ol></li><li><a href="#2.10-line-protocol">2.10 Line Protocol</a><ol> </ol></li><li><a href="#2.11-buffer-protocol">2.11 Buffer Protocol</a><ol> </ol></li><li><a href="#2.12-update-protocol">2.12 Update Protocol</a><ol> </ol></li><li><a href="#2.13-convenience-functions">2.13 Convenience Functions</a><ol> </ol></li></ol></li><li><a href="#3-implementation-protocols">3 Implementation Protocols</a><ol> <li><a href="#3.1-location-comparison-implementation-protocol">3.1 Location Comparison Implementation Protocol</a><ol> </ol></li><li><a href="#3.2-item-container-implementation-protocol">3.2 Item Container Implementation Protocol</a><ol> </ol></li><li><a href="#3.3-line-number-implementation-protocol">3.3 Line Number Implementation Protocol</a><ol> </ol></li><li><a href="#3.4-cursor-implementation-protocol">3.4 Cursor Implementation Protocol</a><ol> <li><a href="#3.4.1-cursor-attachment">3.4.1 Cursor Attachment</a><ol> </ol></li><li><a href="#3.4.2-cursor-location">3.4.2 Cursor Location</a><ol> </ol></li><li><a href="#3.4.3-cursor-movement">3.4.3 Cursor Movement</a><ol> </ol></li><li><a href="#3.4.4-cursor-items">3.4.4 Cursor Items</a><ol> </ol></li></ol></li><li><a href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a><ol> </ol></li><li><a href="#3.6-dock-protocol">3.6 Dock Protocol</a><ol> </ol></li><li><a href="#3.7-buffer-implementation-protocol">3.7 Buffer Implementation Protocol</a><ol> </ol></li><li><a href="#3.8-update-implementation-protocol">3.8 Update Implementation protocol</a><ol> </ol></li></ol></li><li><a href="#4-implementations">4 Implementations</a><ol> <li><a href="#4.1-simple-implementation">4.1 Simple Implementation</a><ol> </ol></li><li><a href="#4.2-standard-implementation">4.2 Standard Implementation</a><ol> </ol></li></ol></li><li><a href="#concept-index">Concept Index</a><ol> </ol></li><li><a href="#function-and-macro-and-variable-and-type-index">Function and Macro and Variable and Type Index</a><ol> </ol></li><li><a href="#changelog">Changelog</a><ol> <li><a href="#version-1.0">Version 1.0</a><ol> </ol></li></ol></li><li><a href="#footnotes">Footnotes</a><ol> </ol></li></ol></nav><div class="content"><h1 class="title">second-cluffer User's Manual</h1><p>This manual is for second-cluffer version 0.1.0.</p><p>Copyright © 2015 -- 2022 Robert Strandh</p><p>Copyright © 2023 -- 2025 Jan Moringen</p><section id="1-introduction"><h2 class="section-title">1 Introduction</h2><p>second-cluffer is a library for representing the buffer of a text editor. As such, it defines a set of Common Lisp Object System <span class="explicit-italic">protocols</span> for client code to interact with the buffer contents in various ways, and it supplies different <span class="explicit-italic">implementations</span> of those protocols for different purposes.</p><p>The buffer protocols have been chosen so that they can fit a variety of editors.  As a consequence, they are not particularly Emacs-centric. For example, in Emacs, a newline character is just another character, so that moving past it using the <code>forward-char</code> command changes the line in which <span class="explicit-italic">point</span> is located, and using the <code>delete-char</code> command when <span class="explicit-italic">point</span> is to the left of a newline character joins the line to the next one.</p><p>In contrast, the buffer protocols documented here are <span class="explicit-italic">line oriented</span> and there is no newline character; only a sequence of lines. At some level, it is of course desirable to have Emacs-compatible commands, but these commands are written separately, using this buffer protocol to accomplish the effects.  For example, the Emacs-compatible <code>forward-item</code> command (which this library does not provide; see <a href="https://github.com/scymtym/text.editing">https://github.com/scymtym/text.editing</a> for a possible implementation) checks whether it is at the end of a line, and if so, detaches the cursor from that line and attaches it to the next one. Similarly, the Emacs compatible <code>delete-item</code> command calls <a class="nil-reference" href="#*-generic-function-second-cluffer|join-line"><span class="explicit-mono">second-cluffer:join-line</span></a> in the buffer protocol to obtain the desired effect when it is at the end of a line.</p><span class="float"><p> <img src="ce30320d60e2be65574301ebd4973ffc84e7a6e9e1c33bc715dbe65bbf1c1220.png"/></p><div class="caption">Examples of important concepts and their relations for a single buffer.</div></span><p>By writing the editor commands in two levels like this, we hope it will be easier to use the buffer protocols to write emulators for other editors, such as <span class="explicit-mono">VIM</span>.</p><p>The buffer participates in two different buffer protocols:</p><ol start="1" style="list-style: decimal;"><li><p>The <span class="explicit-italic">edit protocol</span>, used by client editing and cursor-motion operations.</p></li><li><p>The <span class="explicit-italic">update protocol</span>, used by redisplay operations to determine what items are contained in the buffer.</p></li></ol><p>The operations in the edit protocol were designed to be <span class="explicit-italic">fast</span> (typically around 10 µs so that it is practical to use these TODO we should support operations in a loop, say to insert or delete a region, or to accomplish several operations inside a keyboard macro.  The exceptions are the operations <a class="nil-reference" href="#*-generic-function-second-cluffer|split"><span class="explicit-mono">second-cluffer:split</span></a> and <a class="nil-reference" href="#*-generic-function-second-cluffer|join"><span class="explicit-mono">second-cluffer:join</span></a> that take time proportional to the number of items in the second line. <sup id="text.document-schema.schema:superscript-13"><a class="footnote-reference" href="#text.document-schema.schema:definition-item-1">1</a></sup></p><p>The operations in the update protocol were designed to be called at the frequency of the <span class="explicit-italic">event loop</span> of an application, typically once for each character typed, but also when a window is resized or scrolled (in which case, these operations are very fast since no modifications to the buffer have occurred).</p><p>The buffer edit protocols expose two levels of abstraction to client code:</p><ol start="1" style="list-style: decimal;"><li><p>The <span class="explicit-italic">buffer</span> level represents the <span class="explicit-italic">sequence of lines</span> independently of how the individual lines are represented.</p></li><li><p>The <span class="explicit-italic">line</span> level represents individual lines.</p></li></ol><p>As mentioned above, the buffer protocols do not pretend to manage any equivalence between line breaks and some sequence of characters.  It is up to client code to model such an equivalence if desired.  As a consequence, the buffer protocols do not allow for a cursor at the beginning of a line to move backward or a cursor at the end of a line to move forward.  An attempt at doing so will result in an error being signaled.  If client code wants to impose a model where the line break corresponds to (say) the <span class="explicit-italic">newline</span> character, then it must explicitly detach and reattach the cursor to a different line in these cases.  It can manage that in two different ways: either by explicitly testing for <span class="explicit-mono">TODO:beginning-of-line</span> or <span class="explicit-mono">TODO:end-of-line</span> before calling the equivalent buffer function, or by handling the error that results from the attempt.</p><p>The buffer also does not interpret the meaning of any of items contained in it.  For instance, whether an item is to be considered part of a <span class="explicit-italic">word</span> or not, is not decided at the buffer level, but at the level of the syntax.  As a consequence, the buffer protocol does not offer any functions that require such interpretation, such as <span class="explicit-mono">forward-word</span>, <span class="explicit-mono">end-of-paragraph</span>, etc.</p></section><section id="2-external-protocols"><h2 class="section-title">2 External Protocols</h2><section id="2.1-packages"><h3 class="section-title">2.1 Packages</h3><p>All symbols in the external protocol are in the package named <span class="explicit-mono">second-cluffer</span>.  We recommend against client code <span class="explicit-italic">using</span> this package in the sense of the <span class="explicit-mono">:use</span> option to <span class="explicit-mono">defpackage</span> or in the sense of calling <span class="explicit-mono">use-package</span>.  The reason for this recommendation is that we can not guarantee that future additions to this library will not define external symbols that conflict with symbols in the <span class="explicit-mono">common-lisp</span> package or symbols used by the client for other purposes.</p><p>Instead, we recommend that client code use explicit package prefixes, which in addition will make the origin of the symbol obvious from the source code.  If, for some reason, it is not desirable to use explicit package prefixes, we suggest selectively importing the desired symbols.</p></section><section id="2.2-conditions"><h3 class="section-title">2.2 Conditions</h3><p>second-cluffer defines a number of conditions that are signaled when second-cluffer is unable to fulfill the contract stipulated by the protocol function being used.</p><p> <a id="type-cluffer-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">cluffer-error [second-cluffer]</span><br/><p>This condition type is the base of all error conditions signaled by second-cluffer.  Client code that wishes to handle all error conditions signaled by second-cluffer may use this condition in its condition handlers.</p></div> The following conditions are signaled when an operation on one or more cursors cannot be performed because the supplied cursors are not in the correct state in some way such as not being attached to a suitable line or (indirectly) a suitable buffer.  When any of these conditions is signaled, the cause is a program error in second-cluffer or the client program (as opposed to something the end user did).</p><p><a id="*-class-second-cluffer|cursor-attached-error"> </a> <a id="type-cursor-attached-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">cursor-attached-error [second-cluffer]</span><br/><p>This condition is signaled when an attempt is made to use a cursor in an operation that requires that cursor to be detached, but the cursor used in the operation is attached to a line.</p></div> <a id="*-class-second-cluffer|cursor-detached-error"> </a> <a id="type-cursor-detached-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">cursor-detached-error [second-cluffer]</span><br/><p>This condition is signaled when an attempt is made to use a cursor in an operation that requires that cursor to be attached, but the cursor used in the operation is not attached to any line.</p></div> <a id="*-class-second-cluffer|cursors-not-comparable-error"> </a> <a id="type-cursors-not-comparable-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">cursors-not-comparable-error [second-cluffer]</span><br/><p>This condition is signaled when an attempt is made to compare two cursors which are each attached to a line but the lines do not belong to the same buffer.  The readers <span class="explicit-mono">cursor1</span> and <span class="explicit-mono">cursor2</span> can be used to obtain the offending cursor objects.</p></div> The following conditions are signaled when an operation cannot be performed for the specified location within a line or buffer.  The cause for signaling one of these conditions can be either a program error (in second-cluffer or the client program) or an operation requested by the end user.  Clients can therefore allow end users to request operations on invalid locations and handle the resulting conditions by displaying the condition report to the end user.</p><p><a id="*-class-second-cluffer|beginning-of-line-error"> </a> <a id="type-beginning-of-line-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">beginning-of-line-error [second-cluffer]</span><br/><p>This condition is signaled when an attempt is made to use an index that is negative, either by moving a cursor there, or by attempting to access an item at such an index.</p></div> <a id="*-class-second-cluffer|end-of-line-error"> </a> <a id="type-end-of-line-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">end-of-line-error [second-cluffer]</span><br/><p>This condition is signaled when an attempt is made to use an index that is too large, either by moving a cursor there, or by attempting to access an item at such an index.  Notice that in some cases, ``too large'' means ``strictly greater than the number of items in a line'', and sometimes it means ``greater than or equal to the number of items in a line''.  For example, it is perfectly acceptable to move a cursor to an index that is equal to the number of items in a line, but it is not acceptable to attempt to access an item in a line at that index.</p></div> <a id="*-class-second-cluffer|beginning-of-buffer-error"> </a> <a id="type-beginning-of-buffer-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">beginning-of-buffer-error [second-cluffer]</span><br/><p>This condition is signaled when an attempt is made to use a line number that is negative, for example by issuing a ``previous line'' or ``goto line'' cursor movement command for which the target line number that gets passed to <a class="nil-reference" href="#*-generic-function-second-cluffer|find-line"><span class="explicit-mono">second-cluffer:find-line</span></a> is negative.</p></div> <a id="*-class-second-cluffer|end-of-buffer-error"> </a> <a id="type-end-of-buffer-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">end-of-buffer-error [second-cluffer]</span><br/><p>This condition is signaled when an attempt is made to use a line number that is too large, for example by issuing a ``next line'' or ``goto line'' cursor movement command for which the target line number that gets passed to <a class="nil-reference" href="#*-generic-function-second-cluffer|find-line"><span class="explicit-mono">second-cluffer:find-line</span></a> is larger than the number of lines in the buffer.</p></div> <a id="*-class-second-cluffer|line-detached-error"> </a> <a id="type-line-detached-error-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">line-detached-error [second-cluffer]</span><br/><p>This condition is signaled when an attempt is made to use a line in an operation that requires the line to be attached to a buffer, but the line used in the operation is not attached to a buffer.  An example of such an operation would be to attempt to get the line number of the line, given that the line number of a line is determined by the buffer to which the line is attached.</p></div></p></section><section id="2.3-protocol-classes"><h3 class="section-title">2.3 Protocol Classes</h3><a id="*-class-second-cluffer|line"> </a><a id="type-line-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">line [second-cluffer]</span><br/><p>This class is the base class for all lines.  It should not itself be instantiated.  Instead, second-cluffer contains two different modules each supplying a different subclass of <span class="explicit-mono">line</span> that can be instantiated.</p></div><a id="*-class-second-cluffer|cursor"> </a><a id="type-cursor-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">cursor [second-cluffer]</span><br/><p>This is the base class for all cursors.</p></div><a id="*-class-second-cluffer|buffer"> </a><a id="type-buffer-[second-cluffer]"> </a><div class="component"><span class="kind">type</span><span class="name">buffer [second-cluffer]</span><br/><p>This is the base class for all buffers.  It should not itself be instantiated.  Instead, second-cluffer contains different modules, each providing a different subclass of this class that can be instantiated.</p><p>By default, it is recommended that client code instantiate the class <a class="nil-reference" href="#*-class-second-cluffer.standard-buffer|buffer"><span class="explicit-mono">second-cluffer.standard-buffer:buffer</span></a>.</p></div></section><section id="2.4-location-comparison-protocol"><h3 class="section-title">2.4 Location Comparison Protocol</h3><p>Cursors which are attached to lines which belong to the same buffer can be lexicographically ordered based on their line numbers and within-line indices.  The functions in this protocol allow comparing cursor objects according to this order.</p><p>This functions in this protocol perform checks for invalid arguments, group their arguments into one or more binary operator applications, flip the comparison direction where necessary and then call functions in the <a class="nil-reference" href="#3.1-location-comparison-implementation-protocol">3.1 Location Comparison Implementation Protocol</a> which implement the core behavior based on the classes of the supplied cursors.</p><a id="function-location&lt;-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">location&lt; [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<code>&amp;rest</code>&nbsp;<span class="parameter">more-cursors</span><br/><p>Return true if for each adjacent pair of cursors <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>(c_1, c_2)</mo></math> in the sequence of cursors consisting of <span class="parameter">cursor</span> followed by <span class="parameter">more-cursors</span>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>c_1</mo></math> is positioned before <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>c_2</mo></math> in the buffer.  This function calls the generic function <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|location&lt;"><span class="explicit-mono">second-cluffer.implementation:location&lt;</span></a> for each such pair to check whether the property holds.  As a consequence, return true if only <span class="parameter">cursor</span> is supplied.</p><p>If any of the  is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  Unless all  are attached to lines which belong to the same buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursors-not-comparable-error"><span class="explicit-mono">second-cluffer:cursors-not-comparable-error</span></a> is signaled.</p></div><a id="function-location&lt;=-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">location&lt;= [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<code>&amp;rest</code>&nbsp;<span class="parameter">more-cursors</span><br/><p>Return true if for each adjacent pair of cursors <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>(c_1, c_2)</mo></math> in the sequence of cursors consisting of <span class="parameter">cursor</span> followed by <span class="parameter">more-cursors</span>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>c_1</mo></math> is positioned before <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>c_2</mo></math> or at the same location as <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>c_2</mo></math> in the buffer.  This function calls the generic function <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|location&lt;="><span class="explicit-mono">second-cluffer.implementation:location&lt;=</span></a> for each such pair to check whether the property holds.  As a consequence, return true if only <span class="parameter">cursor</span> is supplied.</p><p>If any of the  is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  Unless all  are attached to lines which belong to the same buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursors-not-comparable-error"><span class="explicit-mono">second-cluffer:cursors-not-comparable-error</span></a> is signaled.</p></div><a id="function-location=-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">location= [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<code>&amp;rest</code>&nbsp;<span class="parameter">more-cursors</span><br/><p>Return true if all cursors in the sequence of cursors consisting of <span class="parameter">cursor</span> followed by <span class="parameter">more-cursors</span> are positioned at the same location in the buffer.  This function calls the generic function <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|location="><span class="explicit-mono">second-cluffer.implementation:location=</span></a> for pairs of cursors to check whether the property holds.  As a consequence, return true if only <span class="parameter">cursor</span> is supplied.</p><p>If any of the  is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  Unless all  are attached to lines which belong to the same buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursors-not-comparable-error"><span class="explicit-mono">second-cluffer:cursors-not-comparable-error</span></a> is signaled.</p></div><a id="function-location/=-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">location/= [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<code>&amp;rest</code>&nbsp;<span class="parameter">more-cursors</span><br/><p>Return true if no two cursors in the sequence of cursors consisting of <span class="parameter">cursor</span> followed by <span class="parameter">more-cursors</span> are positioned at the same location in the buffer.  This function calls the generic function <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|location="><span class="explicit-mono">second-cluffer.implementation:location=</span></a> for <span class="explicit-italic">all</span> pairs of cursors to check whether the property is violated.  As a consequence, return true if only <span class="parameter">cursor</span> is supplied.</p><p>If any of the  is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  Unless all  are attached to lines which belong to the same buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursors-not-comparable-error"><span class="explicit-mono">second-cluffer:cursors-not-comparable-error</span></a> is signaled.</p></div><a id="function-location&gt;=-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">location&gt;= [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<code>&amp;rest</code>&nbsp;<span class="parameter">more-cursors</span><br/><p>Return true if for each adjacent pair of cursors <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>(c_1, c_2)</mo></math> in the sequence of cursors consisting of <span class="parameter">cursor</span> followed by <span class="parameter">more-cursors</span>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>c_1</mo></math> is positioned after or at the same location as <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>c_2</mo></math> in the buffer.  This function calls the generic function <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|location&lt;"><span class="explicit-mono">second-cluffer.implementation:location&lt;</span></a> for each such pair to check whether the property is violated.  As a consequence, return true if only <span class="parameter">cursor</span> is supplied.</p><p>If any of the  is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  Unless all  are attached to lines which belong to the same buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursors-not-comparable-error"><span class="explicit-mono">second-cluffer:cursors-not-comparable-error</span></a> is signaled.</p></div><a id="function-location&gt;-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">location&gt; [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<code>&amp;rest</code>&nbsp;<span class="parameter">more-cursors</span><br/><p>Return true if for each adjacent pair of cursors <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>(c_1, c_2)</mo></math> in the sequence of cursors consisting of <span class="parameter">cursor</span> followed by <span class="parameter">more-cursors</span>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>c_1</mo></math> is positioned strictly after <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>var_2</mo></math> in the buffer.  This function calls the generic function <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|location&lt;="><span class="explicit-mono">second-cluffer.implementation:location&lt;=</span></a> for each such pair to check whether the property is violated.  As a consequence, return true if only <span class="parameter">cursor</span> is supplied.</p><p>If any of the  is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  Unless all  are attached to lines which belong to the same buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursors-not-comparable-error"><span class="explicit-mono">second-cluffer:cursors-not-comparable-error</span></a> is signaled.</p></div></section><section id="2.5-item-container-protocol"><h3 class="section-title">2.5 Item Container Protocol</h3><p>The generic functions in this protocol can be applied to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> instances and <a class="nil-reference" href="#*-class-second-cluffer|line"><span class="explicit-mono">second-cluffer:line</span></a> instances and <a class="nil-reference" href="#*-class-second-cluffer|buffer"><span class="explicit-mono">second-cluffer:buffer</span></a> instances.</p><p>The functions in this protocol perform checks for invalid arguments and invalid state then call the generic functions of the <a class="nil-reference" href="#3.2-item-container-implementation-protocol">3.2 Item Container Implementation Protocol</a> to perform the core behavior based on the class of the supplied container.</p><a id="*-generic-function-second-cluffer|item-count"> </a><a id="function-item-count-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">item-count [second-cluffer]</span>&nbsp;<span class="parameter">container</span><br/><p>If <span class="parameter">container</span> is an attached cursor, return the number of items in the line to which <span class="parameter">container</span> is attached.  If <span class="parameter">container</span> is a cursor that is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>If <span class="parameter">container</span> is a line, then return the number of items in that line.</p><p>If <span class="parameter">container</span> is a buffer, then return the total number of items in that buffer.</p></div><a id="function-items-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">items [second-cluffer]</span>&nbsp;<span class="parameter">container</span>&nbsp;<code>&amp;optional</code>&nbsp;<span class="parameter">start</span>&nbsp;<span class="parameter">end</span><br/><p>Return the items of <span class="parameter">container</span> as a vector.</p><p>The optional parameters <span class="parameter">start</span> and <span class="parameter">end</span> have the same interpretation as for the <span class="explicit-mono">cl:subseq</span> function.</p><p>TODO really for cursor? if so, handle detached case</p><blockquote><p>If <span class="parameter">container</span> is a buffer and <span class="parameter">start</span> and <span class="parameter">end</span> select only a small sub-sequence of all items, the function will likely require a similar amount of computation as selecting all items.  The reason is that second-cluffer does not contain an efficient way of mapping linear indices like <span class="parameter">start</span> and <span class="parameter">end</span> to the respective line which contains that linear index.</p></blockquote></div></section><section id="2.6-line-number-protocol"><h3 class="section-title">2.6 Line Number Protocol</h3><p>The generic functions in this protocol can be applied to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> instances and <a class="nil-reference" href="#*-class-second-cluffer|line"><span class="explicit-mono">second-cluffer:line</span></a> instances.</p><a id="function-line-number-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">line-number [second-cluffer]</span>&nbsp;<span class="parameter">thing</span><br/><p>Return the line number of <span class="parameter">thing</span>.</p><p>If <span class="parameter">thing</span> is a cursor and that cursor is attached to a line, then the generic function <a class="nil-reference" href="#*-generic-function-second-cluffer|line"><span class="explicit-mono">second-cluffer:line</span></a> is called with <span class="parameter">thing</span> as its argument and the return value is used as the argument in a recursive call to <span class="explicit-mono">line-number</span> which behaves as described below. If <span class="parameter">thing</span> is a cursor and that cursor is not attached to any line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>If <span class="parameter">thing</span> is a line and that line is attached to a buffer, then the line number of <span class="parameter">line</span> in that buffer is returned.  The first line of the buffer has the number <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>0</mo></math>. TODO: why not error? If <span class="parameter">thing</span> is a line and that line is not attached to a buffer, then <span class="explicit-mono">nil</span> is returned.</p></div></section><section id="2.7-line-link-protocol"><h3 class="section-title">2.7 Line Link Protocol</h3><p>The generic functions in this protocol can be applied to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> instances.</p><a id="*-generic-function-second-cluffer|line"> </a><a id="function-line-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">line [second-cluffer]</span>&nbsp;<span class="parameter">thing</span><br/><p>TODO what else besides cursor?</p><p>Return the line in which <span class="parameter">thing</span> is located.</p><p>TODO explain nil</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled. TODO</p></div></section><section id="2.8-buffer-link-protocol"><h3 class="section-title">2.8 Buffer Link Protocol</h3><p>This protocol allows obtaining the buffer, if any, to which an object is directly or indirectly attached.  The generic functions in this protocol can be applied to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> instances and <a class="nil-reference" href="#*-class-second-cluffer|line"><span class="explicit-mono">second-cluffer:line</span></a> instances.</p><a id="function-buffer-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">buffer [second-cluffer]</span>&nbsp;<span class="parameter">thing</span><br/><p>Return the buffer to which <span class="parameter">thing</span> is directly or indirectly attached.</p><p>If <span class="parameter">thing</span> is an attached cursor, then return the buffer of the line to which the cursor is attached.  If <span class="parameter">thing</span> is a cursor that is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>If <span class="parameter">thing</span> is a an attached line, then return the buffer to which the line is attached.  If <span class="parameter">thing</span> is a line that is not currently attached to a buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|line-detached-error"><span class="explicit-mono">second-cluffer:line-detached-error</span></a> is signaled.</p><p>TODO code comment says returns nil</p></div></section><section id="2.9-cursor-protocol"><h3 class="section-title">2.9 Cursor Protocol</h3><section id="2.9.1-cursor-attachment"><h4 class="section-title">2.9.1 Cursor Attachment</h4><a id="function-attachedp-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">attachedp [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return <span class="explicit-italic">true</span> if <span class="parameter">cursor</span> is attached to a line.</p></div><a id="function-attach-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">attach [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<span class="parameter">line</span>&nbsp;<code>&amp;optional</code>&nbsp;<span class="parameter">(index 0)</span><br/><p>Attach <span class="parameter">cursor</span> to <span class="parameter">line</span> at <span class="parameter">index</span>.</p><p>If <span class="parameter">index</span> is supplied and it is greater than the number of items in <span class="parameter">line</span>, the <a class="nil-reference" href="#*-class-second-cluffer|end-of-line-error"><span class="explicit-mono">second-cluffer:end-of-line-error</span></a> is signaled. If <span class="parameter">cursor</span> is already attached to a line, <a class="nil-reference" href="#*-class-second-cluffer|cursor-attached-error"><span class="explicit-mono">second-cluffer:cursor-attached-error</span></a> is signaled.</p><p>This function typically calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|attach"><span class="explicit-mono">second-cluffer.implementation:attach</span></a> to actually perform the operation.</p></div><a id="function-detach-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">detach [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Detach <span class="parameter">cursor</span> from the line to which it is attached.</p><p>If <span class="parameter">cursor</span> is already detached, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>This function typically calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|detach"><span class="explicit-mono">second-cluffer.implementation:detach</span></a> to actually perform the operation.</p></div></section><section id="2.9.2-cursor-location"><h4 class="section-title">2.9.2 Cursor Location</h4><a id="*-generic-function-second-cluffer|index"> </a><a id="function-index-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">index [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return the index of <span class="parameter">cursor</span> in the line to which it is attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p></div><a id="*-generic-function-second-cluffer|(setf-index)"> </a><a id="function-(setf-index)-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">(setf index) [second-cluffer]</span>&nbsp;<span class="parameter">new-value</span>&nbsp;<span class="parameter">cursor</span><br/><p>Set the index of <span class="parameter">cursor</span> to <span class="parameter">new-value</span> in the line to which <span class="parameter">cursor</span> is attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>If <span class="parameter">new-value</span> is negative, then a condition of type <a class="nil-reference" href="#*-class-second-cluffer|beginning-of-line-error"><span class="explicit-mono">second-cluffer:beginning-of-line-error</span></a> is signaled.  If <span class="parameter">new-value</span> is strictly greater than the number of items in the line to which <span class="parameter">cursor</span> is attached (See <a class="nil-reference" href="#*-generic-function-second-cluffer|item-count"><span class="explicit-mono">second-cluffer:item-count</span></a>), then a condition of type <a class="nil-reference" href="#*-class-second-cluffer|end-of-line-error"><span class="explicit-mono">second-cluffer:end-of-line-error</span></a> is signaled.</p></div><a id="function-beginning-of-line-p-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">beginning-of-line-p [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return <span class="explicit-italic">true</span> if and only if <span class="parameter">cursor</span> is located at the beginning of the line to which <span class="parameter">cursor</span> is attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to calling the function <a class="nil-reference" href="#*-generic-function-second-cluffer|index"><span class="explicit-mono">second-cluffer:index</span></a> with <span class="parameter">cursor</span> as argument and comparing the return value to <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>0</mo></math>.  However, this function might be implemented differently for reasons of performance.</p></div><a id="function-end-of-line-p-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">end-of-line-p [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return <span class="explicit-italic">true</span> if and only if <span class="parameter">cursor</span> is located at the end of the line to which <span class="parameter">cursor</span> is attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to calling the function <a class="nil-reference" href="#*-generic-function-second-cluffer|index"><span class="explicit-mono">second-cluffer:index</span></a> with <span class="parameter">cursor</span> as argument and comparing the return value to the number of items in the line to which <span class="parameter">cursor</span> is attached (See <a class="nil-reference" href="#*-generic-function-second-cluffer|item-count"><span class="explicit-mono">second-cluffer:item-count</span></a>). However, this function might be implemented differently for reasons of performance.</p></div><a id="function-beginning-of-buffer-p-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">beginning-of-buffer-p [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return <span class="explicit-italic">true</span> if and only if <span class="parameter">cursor</span> is located at the beginning of the buffer to which <span class="parameter">cursor</span> is indirectly attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  If <span class="parameter">cursor</span> is attached to a line, but that line is not attached to a buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|line-detached-error"><span class="explicit-mono">second-cluffer:line-detached-error</span></a> is signaled.</p></div><a id="function-end-of-buffer-p-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">end-of-buffer-p [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return <span class="explicit-italic">true</span> if and only if <span class="parameter">cursor</span> is located at the end of the buffer to which <span class="parameter">cursor</span> is indirectly attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  If <span class="parameter">cursor</span> is attached to a line, but that line is not attached to a buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|line-detached-error"><span class="explicit-mono">second-cluffer:line-detached-error</span></a> is signaled.</p></div></section><section id="2.9.3-cursor-movement"><h4 class="section-title">2.9.3 Cursor Movement</h4><p> <a id="function-forward-item-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">forward-item [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Move <span class="parameter">cursor</span> forward one index.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to incrementing the <a class="nil-reference" href="#*-generic-function-second-cluffer|index"><span class="explicit-mono">second-cluffer:index</span></a> of <span class="parameter">cursor</span>.  However, this function might be implemented differently for reasons of performance.</p></div>  <a id="function-backward-item-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">backward-item [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Move <span class="parameter">cursor</span> backward one index.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to decrementing the <a class="nil-reference" href="#*-generic-function-second-cluffer|index"><span class="explicit-mono">second-cluffer:index</span></a> of <span class="parameter">cursor</span>.  However, this function might be implemented differently for reasons of performance.</p></div>  <a id="function-beginning-of-line-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">beginning-of-line [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Position <span class="parameter">cursor</span> at the very beginning of the line to which it is attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to calling the function <a class="nil-reference" href="#*-generic-function-second-cluffer|(setf-index)"><span class="explicit-mono">second-cluffer:(setf index)</span></a> with <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>0</mo></math> and <span class="parameter">cursor</span> as arguments.  However, this function might be implemented differently for reasons of performance.</p></div>  <a id="function-end-of-line-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">end-of-line [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Position <span class="parameter">cursor</span> at the very end of the line to which it is attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to calling the function <a class="nil-reference" href="#*-generic-function-second-cluffer|(setf-index)"><span class="explicit-mono">second-cluffer:(setf index)</span></a> with the number of items in the line to which <span class="parameter">cursor</span> is attached (See <a class="nil-reference" href="#*-generic-function-second-cluffer|item-count"><span class="explicit-mono">second-cluffer:item-count</span></a>) and <span class="parameter">cursor</span> as arguments. However, this function might be implemented differently for reasons of performance.</p></div></p></section><section id="2.9.4-cursor-items"><h4 class="section-title">2.9.4 Cursor Items</h4><a id="function-item-before-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">item-before [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return the item located immediately before <span class="parameter">cursor</span>.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>If <span class="parameter">cursor</span> is positioned at the beginning of the line it is attached to, signal a condition of type <a class="nil-reference" href="#*-class-second-cluffer|beginning-of-line-error"><span class="explicit-mono">second-cluffer:beginning-of-line-error</span></a>.</p><p>Calling this function is equivalent to calling <a class="nil-reference" href="#*-generic-function-second-cluffer|item"><span class="explicit-mono">second-cluffer:item</span></a> with the line to which <span class="parameter">cursor</span> is attached (See <a class="nil-reference" href="#*-generic-function-second-cluffer|line"><span class="explicit-mono">second-cluffer:line</span></a>) and the index of <span class="parameter">cursor</span> (See <a class="nil-reference" href="#*-generic-function-second-cluffer|index"><span class="explicit-mono">second-cluffer:index</span></a>) minus one. However, this function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|item-before"><span class="explicit-mono">second-cluffer.implementation:item-before</span></a> and the implementation performs the operation in an opaque way that allows for better performance or meets other requirements.</p></div><a id="function-item-after-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">item-after [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return the item located immediately after <span class="parameter">cursor</span>.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>If <span class="parameter">cursor</span> is positioned at the end of the line it is attached to, signal a condition of type <a class="nil-reference" href="#*-class-second-cluffer|end-of-line-error"><span class="explicit-mono">second-cluffer:end-of-line-error</span></a>.</p><p>Calling this function is equivalent to calling <a class="nil-reference" href="#*-generic-function-second-cluffer|item"><span class="explicit-mono">second-cluffer:item</span></a> with the line to which <span class="parameter">cursor</span> is attached (See <a class="nil-reference" href="#*-generic-function-second-cluffer|line"><span class="explicit-mono">second-cluffer:line</span></a>) and the index of <span class="parameter">cursor</span> (See <a class="nil-reference" href="#*-generic-function-second-cluffer|index"><span class="explicit-mono">second-cluffer:index</span></a>).  However, this function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|item-after"><span class="explicit-mono">second-cluffer.implementation:item-after</span></a> and the implementation performs the operation in an opaque way that allows for better performance or meets other requirements.</p></div><a id="function-insert-item-at-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">insert-item-at [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<span class="parameter">item</span><br/><p>Insert <span class="parameter">item</span> at the index of <span class="parameter">cursor</span>. TODO: return value</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to calling <a class="nil-reference" href="#*-generic-function-second-cluffer|insert-item"><span class="explicit-mono">second-cluffer:insert-item</span></a> with the line to which <span class="parameter">cursor</span> is attached, <span class="parameter">item</span>, and the index of <span class="parameter">cursor</span>. However, this function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|delete-item-after"><span class="explicit-mono">second-cluffer.implementation:delete-item-after</span></a> and the implementation performs the operation in an opaque way that allows for better performance or meets other requirements.</p></div><a id="function-delete-item-before-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">delete-item-before [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Delete the item immediately before <span class="parameter">cursor</span>. TODO: return value</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to calling <a class="nil-reference" href="#*-generic-function-second-cluffer|delete-item"><span class="explicit-mono">second-cluffer:delete-item</span></a> with the line to which <span class="parameter">cursor</span> is attached and the index of <span class="parameter">cursor</span> minus one. However, this function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|delete-item-before"><span class="explicit-mono">second-cluffer.implementation:delete-item-before</span></a> and the implementation performs the operation in an opaque way that allows for better performance or meets other requirements.</p></div><a id="function-delete-item-after-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">delete-item-after [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Delete the item immediately after <span class="parameter">cursor</span>. TODO: return value</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to calling <a class="nil-reference" href="#*-generic-function-second-cluffer|delete-item"><span class="explicit-mono">second-cluffer:delete-item</span></a> with the line to which <span class="parameter">cursor</span> is attached and the index of <span class="parameter">cursor</span>. However, this function might be implemented differently for reasons of performance.</p></div><a id="function-split-line-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">split-line [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.</p><p>Calling this function is equivalent to calling <a class="nil-reference" href="#*-generic-function-second-cluffer|split"><span class="explicit-mono">second-cluffer:split</span></a>, passing it the line to which <span class="parameter">cursor</span> is attached, and the index of <span class="parameter">cursor</span>. However, this function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|split-using-buffer"><span class="explicit-mono">second-cluffer.implementation:split-using-buffer</span></a> and the implementation performs the operation in an opaque way that allows for better performance or meets other requirements..</p></div><a id="*-generic-function-second-cluffer|join-line"> </a><a id="function-join-line-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">join-line [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Join the line to which <span class="parameter">cursor</span> is attached with the line following it in the buffer to which the line is attached.</p><p>If <span class="parameter">cursor</span> is not currently attached to a line, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|cursor-detached-error"><span class="explicit-mono">second-cluffer:cursor-detached-error</span></a> is signaled.  If <span class="parameter">cursor</span> is attached to the last line of the buffer, the condition <a class="nil-reference" href="#*-class-second-cluffer|end-of-buffer-error"><span class="explicit-mono">second-cluffer:end-of-buffer-error</span></a> will be signaled.</p><p>Calling this function is equivalent to calling <a class="nil-reference" href="#*-generic-function-second-cluffer|join"><span class="explicit-mono">second-cluffer:join</span></a>, passing it the line to which <span class="parameter">cursor</span> is attached, and the index of <span class="parameter">cursor</span>. However, this function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|join-using-buffer"><span class="explicit-mono">second-cluffer.implementation:join-using-buffer</span></a> and the implementation performs the operation in an opaque way that allows for better performance or meets other requirements..</p></div></section></section><section id="2.10-line-protocol"><h3 class="section-title">2.10 Line Protocol</h3><p> <a id="function-first-line-p-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">first-line-p [second-cluffer]</span>&nbsp;<span class="parameter">line</span><br/><p>Return <span class="explicit-italic">true</span> if <span class="parameter">line</span> is the first line in the buffer it is attached to.</p><p>If <span class="parameter">line</span> is not currently attached to a buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|line-detached-error"><span class="explicit-mono">second-cluffer:line-detached-error</span></a> is signaled.</p></div>  <a id="function-last-line-p-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">last-line-p [second-cluffer]</span>&nbsp;<span class="parameter">line</span><br/><p>Return <span class="explicit-italic">true</span> if <span class="parameter">line</span> is the last in the buffer it is attached to.</p><p>If <span class="parameter">line</span> is not currently attached to a buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|line-detached-error"><span class="explicit-mono">second-cluffer:line-detached-error</span></a> is signaled.</p></div>  <a id="function-cursors-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">cursors [second-cluffer]</span>&nbsp;<span class="parameter">line</span><br/><p>Return a list of the cursors attached to <span class="parameter">line</span>.</p><p>The order of the cursor objects in the returned list is unspecified.  In particular, clients must not rely on the cursor objects being ordered according to their <a class="nil-reference" href="#*-generic-function-second-cluffer|index"><span class="explicit-mono">second-cluffer:index</span></a>.</p><p>Furthermore, the returned list may be destructively modified by a subsequent operation on a related cursor, line or buffer object.  In other words, clients that retain the returned set of cursors must copy the cursor list or otherwise transfer the cursor objects into some other container before invoking a subsequent operation.</p><p>This function typically calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|cursors"><span class="explicit-mono">second-cluffer.implementation:cursors</span></a> to actually perform the operation.</p></div> <a id="*-generic-function-second-cluffer|item"> </a> <a id="function-item-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">item [second-cluffer]</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span><br/><p>Return the item located at <span class="parameter">index</span> in <span class="parameter">line</span>.</p><p>If <span class="parameter">index</span> is less than zero, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|beginning-of-line-error"><span class="explicit-mono">second-cluffer:beginning-of-line-error</span></a> is signaled.  If <span class="parameter">index</span> is greater than or equal to the number of items in <span class="parameter">line</span> (See <a class="nil-reference" href="#*-generic-function-second-cluffer|item-count"><span class="explicit-mono">second-cluffer:item-count</span></a>), a condition of type <a class="nil-reference" href="#*-class-second-cluffer|end-of-line-error"><span class="explicit-mono">second-cluffer:end-of-line-error</span></a> is signaled.</p><p>This function typically calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|item"><span class="explicit-mono">second-cluffer.implementation:item</span></a> to actually perform the operation.</p></div> <a id="*-generic-function-second-cluffer|insert-item"> </a> <a id="function-insert-item-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">insert-item [second-cluffer]</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span>&nbsp;<span class="parameter">item</span><br/><p>Insert <span class="parameter">item</span> into <span class="parameter">line</span> at <span class="parameter">index</span>. TODO: return value</p><p><a id="concept-left-sticky"> </a><a id="concept-right-sticky"> </a>After this operation completes, what happens to cursors located at <span class="parameter">index</span> before the operation depends on the class of the cursor and of <span class="parameter">line</span>.  The <a class="nil-reference" href="#4.2-standard-implementation">standard implementation</a> provides two kinds of cursors, namely <a class="nil-reference" href="#*-class-second-cluffer.standard-line|left-sticky-cursor"><span class="explicit-mono">second-cluffer.standard-line:left-sticky-cursor</span></a> and <a class="nil-reference" href="#*-class-second-cluffer.standard-line|right-sticky-cursor"><span class="explicit-mono">second-cluffer.standard-line:right-sticky-cursor</span></a>.  For such an implementation, after this operation completes, any left-sticky cursor located at <span class="parameter">index</span> will be located before <span class="parameter">item</span>, and any right-sticky cursor will be located <span class="parameter">index</span> will be located after <span class="parameter">item</span>.</p><p>If <span class="parameter">index</span> is less than zero, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|beginning-of-line-error"><span class="explicit-mono">second-cluffer:beginning-of-line-error</span></a> is signaled.  If <span class="parameter">index</span> is greater than the number of items in <span class="parameter">line</span> (See <a class="nil-reference" href="#*-generic-function-second-cluffer|item-count"><span class="explicit-mono">second-cluffer:item-count</span></a>), a condition of type <a class="nil-reference" href="#*-class-second-cluffer|end-of-line-error"><span class="explicit-mono">second-cluffer:end-of-line-error</span></a> is signaled.</p><p>This function typically calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|insert-item"><span class="explicit-mono">second-cluffer.implementation:insert-item</span></a> to actually perform the operation.</p></div> <a id="*-generic-function-second-cluffer|delete-item"> </a> <a id="function-delete-item-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">delete-item [second-cluffer]</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span><br/><p>Delete the item at <span class="parameter">index</span> in <span class="parameter">line</span>.</p><p>If <span class="parameter">index</span> is less than zero, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|beginning-of-line-error"><span class="explicit-mono">second-cluffer:beginning-of-line-error</span></a> is signaled.  If <span class="parameter">position</span> is greater than or equal to the number of items in <span class="parameter">line</span> (See <a class="nil-reference" href="#*-generic-function-second-cluffer|item-count"><span class="explicit-mono">second-cluffer:item-count</span></a>), a condition of type <a class="nil-reference" href="#*-class-second-cluffer|end-of-line-error"><span class="explicit-mono">second-cluffer:end-of-line-error</span></a> is signaled.</p><p>This function typically calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|delete-item"><span class="explicit-mono">second-cluffer.implementation:delete-item</span></a> to actually perform the operation.</p></div> <a id="*-generic-function-second-cluffer|split"> </a> <a id="function-split-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">split [second-cluffer]</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span><br/><p>Split <span class="parameter">line</span> into two lines, one of which is newly created and return the newly created line.</p><p>The first line contains the items and cursors preceding <span class="parameter">index</span> and the second line contains the items and cursors following <span class="parameter">index</span>.</p><p>TODO is unspecified return value good? (stated below)</p><p><a id="concept-left-sticky-2"> </a><a id="concept-right-sticky-7"> </a>After this operation, any left-sticky cursor located at <span class="parameter">index</span> will be located at the end of the first line, and any right-sticky cursor located at <span class="parameter">index</span> will be located at the beginning of the second line.</p><p>This operation is implemented in one of two ways:</p><ol start="1" style="list-style: decimal;"><li><p>Either the prefix is moved from the original line to a new line.  In this case, the second of the two resulting lines is <span class="explicit-mono">eq</span> to the original one.</p></li><li><p>Or the suffix is moved from the original line to a new line.  In this case, the first of the two resulting lines is <span class="explicit-mono">eq</span> to the original one.</p></li></ol><p>However, it is not specified which of the two techniques is used, and it is not specified what value is returned from this operation.</p><p>If <span class="parameter">line</span> is not currently attached to a buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|line-detached-error"><span class="explicit-mono">second-cluffer:line-detached-error</span></a> is signaled.</p><p>To actually perform the operation, this function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|split-using-buffer"><span class="explicit-mono">second-cluffer.implementation:split-using-buffer</span></a> which in turn calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|make-line-like"><span class="explicit-mono">second-cluffer.implementation:make-line-like</span></a> with <span class="parameter">line</span> and appropriate keyword arguments to create the new line.</p></div> <a id="*-generic-function-second-cluffer|join"> </a> <a id="function-join-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">join [second-cluffer]</span>&nbsp;<span class="parameter">line</span><br/><p>Join <span class="parameter">line</span> with the line following it in the buffer to which <span class="parameter">line</span> is attached which we will call <span class="parameter">next-line</span> and return the remaining line.</p><p>Items and cursors from <span class="parameter">next-line</span> are transferred to <span class="parameter">line</span>.</p><p>If <span class="parameter">line</span> is not currently attached to a buffer, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|line-detached-error"><span class="explicit-mono">second-cluffer:line-detached-error</span></a> is signaled.</p><p>If <span class="parameter">line</span> is the last line of the buffer to which it is attached, a condition of type <a class="nil-reference" href="#*-class-second-cluffer|end-of-buffer-error"><span class="explicit-mono">second-cluffer:end-of-buffer-error</span></a> is signaled.</p><p>This function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|join-using-buffer"><span class="explicit-mono">second-cluffer.implementation:join-using-buffer</span></a> to actually perform the operation.</p></div> </p><blockquote><p>Notice that the protocols described here do not contain any <span class="explicit-mono">delete-line</span> operation.  This design decision was made on purpose. By only providing <a class="nil-reference" href="#*-generic-function-second-cluffer|join"><span class="explicit-mono">second-cluffer:join</span></a>, we guarantee that removing a line leaves a <span class="explicit-italic">trace</span> in the buffer in the form of a modification operation on the first of the two lines that were joined. This features is essential in order for the <a class="nil-reference" href="#2.12-update-protocol">2.12 Update Protocol</a> to work correctly.</p></blockquote></section><section id="2.11-buffer-protocol"><h3 class="section-title">2.11 Buffer Protocol</h3><a id="function-line-count-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">line-count [second-cluffer]</span>&nbsp;<span class="parameter">buffer</span><br/><p>Return the number of lines in <span class="parameter">buffer</span>.</p></div><a id="*-generic-function-second-cluffer|find-line"> </a><a id="function-find-line-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">find-line [second-cluffer]</span>&nbsp;<span class="parameter">buffer</span>&nbsp;<span class="parameter">line-number</span><br/><p>Return the line in the buffer with the given <span class="parameter">line-number</span>.</p><p>If <span class="parameter">line-number</span> is less than <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>0</mo></math> then the error <a class="nil-reference" href="#*-class-second-cluffer|beginning-of-buffer-error"><span class="explicit-mono">second-cluffer:beginning-of-buffer-error</span></a> is signaled.  If <span class="parameter">line-number</span> is greater than or equal to the number of lines in the buffer, then the error <a class="nil-reference" href="#*-class-second-cluffer|end-of-buffer-error"><span class="explicit-mono">second-cluffer:end-of-buffer-error</span></a> is signaled.</p></div></section><section id="2.12-update-protocol"><h3 class="section-title">2.12 Update Protocol</h3><p>The purpose of the buffer update protocol is to allow for a number of edit operations to the buffer without updating the view of the buffer. This functionality is important because a single command may result in an arbitrary number of edit operations to the buffer, and we typically want the view to be updated only once, when all those edit operations have been executed.</p><p><a id="concept-time-stamp"> </a>At the center of the update protocol is the concept of a <span class="explicit-italic">time   stamp</span>.  The nature of this time stamp is not specified, other than the fact that its value is incremented for each operation that alters the contents of the buffer.  The only operation allowed by client code on a time stamp is to store it and pass it as an argument to the protocol function <a class="nil-reference" href="#*-generic-function-second-cluffer|update"><span class="explicit-mono">second-cluffer:update</span></a>.</p><p>TODO </p><div class="listing"><pre>;;; The purpose of the buffer update protocol is to allow for a number
;;; of edit operations to the buffer without updating the view of the
;;; buffer.  This functionality is important because a single command
;;; may result in an arbitrary number of edit operations to the
;;; buffer, and we typically want the view to be updated only once,
;;; when all those edit operations have been executed.
;;;
;;; The buffer update protocol has been designed to allow for
;;; different representations of the view.  Seen from the UPDATE
;;; function, the view takes the form of four different editing
;;; operations, namely CREATE, MODIFY, SYNC, and SKIP.  These editing
;;; operations are represented as functions that are supplied by
;;; client code as arguments to the UPDATE function.  The editing
;;; operations only assume that the view keeps a copy of the structure
;;; of the lines of the buffer, and that this copy has a cursor that
;;; is affected by the editing operations.  This cursor can be before
;;; the first line of the view, after the last line of the view, or
;;; between two lines of the view.  When BUFFER is called by client
;;; code, the cursor is located before the first line of the view.
</pre></div><a id="*-generic-function-second-cluffer|update"> </a><a id="function-update-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">update [second-cluffer]</span>&nbsp;<span class="parameter">buffer</span>&nbsp;<span class="parameter">time</span>&nbsp;<span class="parameter">sync</span>&nbsp;<span class="parameter">skip</span>&nbsp;<span class="parameter">modify</span>&nbsp;<span class="parameter">create</span><br/><p>The <span class="parameter">buffer</span> parameter is a buffer that might have been modified since the last call to <span class="explicit-mono">update</span>.  The <span class="parameter">time</span> parameter is the time stamp of the last time the <span class="explicit-mono">update</span> was called, so that the <span class="parameter">update</span> function will report modifications since that time.  In addition to time stamps, the <span class="parameter">time</span> argument can also be <span class="explicit-mono">nil</span>, which is interpreted as the beginning of time.  Thus, when <span class="explicit-mono">nil</span> is given as a value of this argument, the operations generated correspond to the creation of the buffer.</p><p>The <span class="parameter">update</span> function returns a new time stamp to be used as the <span class="parameter">time</span> argument in the next call to <span class="parameter">update</span>.</p><p>The time stamp is specific to each buffer, and more importantly, to each <span class="explicit-italic">buffer implementation</span>.  The consequences are unspecified if a time stamp returned by calling <span class="parameter">update</span> on one buffer is used in a call to <span class="parameter">update</span> with a different buffer.</p><p>The parameters <span class="parameter">sync</span>, <span class="parameter">skip</span>, <span class="parameter">modify</span>, and <span class="parameter">create</span>, are functions that are called by the <span class="explicit-mono">update</span> function.  They are to be considered as <span class="explicit-italic">edit operations</span> on some representation of the buffer as it was after the previous call to <span class="explicit-mono">update</span>.  The operations have the following meaning:</p><dl><dt><span class="explicit-mono">sync</span></dt><dd><p>indicates the first unmodified line after a sequence of new or modified lines.  Accordingly, this function is called once, following one or more calls to <span class="parameter">create</span> or <span class="parameter">modify</span>.  This function is called with a single argument: the unmodified line.  Client code must compare the current line of its view to the argument, and delete the current line repeatedly until the two are <span class="explicit-mono">eq</span>.  Finally, it must make the immediately following line the current one.</p></dd><dt><span class="explicit-mono">skip</span></dt><dd><p>indicates that a number of lines have not been subject to any modifications since the last <span class="explicit-mono">update</span> call.  The function takes a single argument, the number of lines to skip.  This function is called <span class="explicit-italic">first</span> to indicate that a <span class="explicit-italic">prefix</span> of the buffer is unmodified, or after a <span class="parameter">sync</span> operation to indicate that that many lines following the one given as argument to the <span class="parameter">sync</span> operation are unmodified.  This operation is also called when there are unmodified lines at the end of the buffer so that the total line count of the buffer corresponds to the total number of lines mentioned in the sequence of operations.</p></dd><dt><span class="explicit-mono">modify</span></dt><dd><p>indicates a line that has been modified.  The function is called with that line as the argument.  Client code must compare the current line of its view to the argument, and delete the current line repeatedly until the two are <span class="explicit-mono">eq</span>.  It must then take whatever action is needed for the modified contents of the line, and finally it must make the immediately following line the current one.</p></dd><dt><span class="explicit-mono">create</span></dt><dd><p>indicates a line that has been created.  The function is called with that line as the argument.  Client code should insert the new line at the position of the cursor, and then leave the cursor positioned immediately after the inserted line.</p></dd></dl></div></section><section id="2.13-convenience-functions"><h3 class="section-title">2.13 Convenience Functions</h3><p><a id="*-function-second-cluffer|make-empty-buffer"> </a> <a id="function-make-empty-buffer-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">make-empty-buffer [second-cluffer]</span>&nbsp;<code>&amp;key</code>&nbsp;<span class="parameter">(buffer-class 'second-cluffer.standard-buffer:buffer)</span>&nbsp;<span class="parameter">(line-class 'second-cluffer.standard-line:line)</span>&nbsp;<span class="parameter">(cursor-class 'second-cluffer.standard-line:right-sticky-cursor)</span><br/><p>TODO: We should probably rename this to make-buffer and add an initial-contents keyword parameter</p><p>Create a buffer, a line and a cursor and return those objects as three values.  The line is contained in the buffer and the cursor is attached to the line.  The line does not contain any items.</p><p><span class="parameter">buffer-class</span>, if supplied, specifies the class of the created buffer.  The default is <a class="nil-reference" href="#*-class-second-cluffer.standard-buffer|buffer"><span class="explicit-mono">second-cluffer.standard-buffer:buffer</span></a>.</p><p><span class="parameter">line-class</span>, if supplied, specifies the class of the created line.  The default is <a class="nil-reference" href="#*-class-second-cluffer.standard-line|line"><span class="explicit-mono">second-cluffer.standard-line:line</span></a>.</p><p><span class="parameter">cursor-class</span>, if supplied, specifies the class of the created cursor.  The default is <a class="nil-reference" href="#*-class-second-cluffer.standard-line|right-sticky-cursor"><span class="explicit-mono">second-cluffer.standard-line:right-sticky-cursor</span></a>.</p></div></p></section></section><section id="3-implementation-protocols"><h2 class="section-title">3 Implementation Protocols</h2><p> TODO introduction</p><p>For many of the generic functions described in this chapter, default methods exist which are specialized to one of the protocol classes <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a>, <a class="nil-reference" href="#*-class-second-cluffer|line"><span class="explicit-mono">second-cluffer:line</span></a> or <a class="nil-reference" href="#*-class-second-cluffer|buffer"><span class="explicit-mono">second-cluffer:buffer</span></a> and perform the required behavior, possibly in an inefficient way, by calling other generic functions from the implementation protocols.  A new implementation does not have to define methods on generic functions with such a default function but may do so anyway, for example in order to provide a more efficient implementation.</p><section id="3.1-location-comparison-implementation-protocol"><h3 class="section-title">3.1 Location Comparison Implementation Protocol</h3><p>The functions of the <a class="nil-reference" href="#2.4-location-comparison-protocol">2.4 Location Comparison Protocol</a> perform checks for invalid arguments, group their arguments into one or more binary operator applications, flip the comparison direction where necessary and then call the generic functions of this protocol to perform the core behavior.</p><a id="*-generic-function-second-cluffer.implementation|location&lt;"> </a><a id="function-location&lt;-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">location&lt; [second-cluffer.implementation]</span>&nbsp;<span class="parameter">location1</span>&nbsp;<span class="parameter">location2</span><br/><p>Return <span class="explicit-italic">true</span> if <span class="parameter">location1</span> is positioned strictly before <span class="parameter">location2</span> in the buffer.</p><p>All locations have to be attached to lines which in turn must all belong to a single buffer. occur.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p></div><a id="*-generic-function-second-cluffer.implementation|location&lt;="> </a><a id="function-location&lt;=-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">location&lt;= [second-cluffer.implementation]</span>&nbsp;<span class="parameter">location1</span>&nbsp;<span class="parameter">location2</span><br/><p>Return <span class="explicit-italic">true</span> if <span class="parameter">location1</span> is positioned before or at the same position as <span class="parameter">location2</span> in the buffer.</p><p>All locations have to be attached to lines which in turn must all belong to a single buffer. occur.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p></div><a id="*-generic-function-second-cluffer.implementation|location="> </a><a id="function-location=-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">location= [second-cluffer.implementation]</span>&nbsp;<span class="parameter">location1</span>&nbsp;<span class="parameter">location2</span><br/><p>Return <span class="explicit-italic">true</span> if <span class="parameter">location1</span> is positioned at the same position as <span class="parameter">location2</span> in the buffer.</p><p>All locations have to be attached to lines which in turn must all belong to a single buffer. occur.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p></div></section><section id="3.2-item-container-implementation-protocol"><h3 class="section-title">3.2 Item Container Implementation Protocol</h3><p>The default methods of the <a class="nil-reference" href="#2.5-item-container-protocol">2.5 Item Container Protocol</a> perform checks for invalid arguments and invalid state then call the generic functions of this protocol to perform the core behavior.</p><p>This protocol is implemented by line classes and buffer classes but not cursor classes since those delegate to the respective line they are attached to.</p><a id="*-generic-function-second-cluffer.implementation|item-count"> </a><a id="function-item-count-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">item-count [second-cluffer.implementation]</span>&nbsp;<span class="parameter">container</span><br/><p>Return the number of items in <span class="parameter">container</span>.</p></div><a id="function-items-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">items [second-cluffer.implementation]</span>&nbsp;<span class="parameter">container</span>&nbsp;<span class="parameter">start</span>&nbsp;<span class="parameter">end</span><br/><p>Return the sub-sequence of items in <span class="parameter">container</span> designated by <span class="parameter">start</span> and <span class="parameter">end</span>.</p><p><span class="parameter">start</span> must be valid start bound for a sub-sequence of the items in <span class="parameter">container</span>.  <span class="parameter">end</span> must be either <span class="explicit-mono">nil</span> or valid end bound for a sub-sequence of the items in <span class="parameter">container</span>. These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p></div></section><section id="3.3-line-number-implementation-protocol"><h3 class="section-title">3.3 Line Number Implementation Protocol</h3><a id="function-line-number-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">line-number [second-cluffer.implementation]</span>&nbsp;<span class="parameter">thing</span><br/></div></section><section id="3.4-cursor-implementation-protocol"><h3 class="section-title">3.4 Cursor Implementation Protocol</h3><a id="concept-stickiness"> </a><a id="concept-left-sticky-3"> </a><a id="concept-right-sticky-8"> </a><a id="function-stickiness-[second-cluffer]"> </a><div class="component"><span class="kind">function</span><span class="name">stickiness [second-cluffer]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return either <code>:left</code> or <code>:right</code> to indicate the stickiness of <span class="parameter">cursor</span>.</p></div><section id="3.4.1-cursor-attachment"><h4 class="section-title">3.4.1 Cursor Attachment</h4><a id="*-generic-function-second-cluffer.implementation|attach"> </a><a id="function-attach-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">attach [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span><br/><p>Attach <span class="parameter">cursor</span> to <span class="parameter">line</span> at <span class="parameter">index</span>.</p><p><span class="parameter">cursor</span> must not already be attached to a line.  <span class="parameter">index</span> must not be negative and has to be less than the number of items in <span class="parameter">line</span>.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p></div><a id="*-generic-function-second-cluffer.implementation|detach"> </a><a id="function-detach-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">detach [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Detach <span class="parameter">cursor</span> from the line to which it is attached.</p><p><span class="parameter">cursor</span> has to be attached to a line.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur.</p></div></section><section id="3.4.2-cursor-location"><h4 class="section-title">3.4.2 Cursor Location</h4><a id="*-generic-function-second-cluffer.implementation|index"> </a><a id="function-index-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">index [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return the index of <span class="parameter">cursor</span> in the line to which it is attached.</p><p><span class="parameter">cursor</span> has to be attached to a line.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur.</p></div><a id="function-(setf-index)-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">(setf index) [second-cluffer.implementation]</span>&nbsp;<span class="parameter">new-value</span>&nbsp;<span class="parameter">cursor</span><br/><p>Set the index of <span class="parameter">cursor</span> to <span class="parameter">new-value</span> in the line to which cursor is attached.</p><p><span class="parameter">cursor</span> has to be attached to a line.  <span class="parameter">new-value</span> most not be negative or strictly greater than the number of items in the line to which <span class="parameter">cursor</span> is attached.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur.</p></div><a id="function-beginning-of-line-p-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">beginning-of-line-p [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return <span class="explicit-italic">true</span> if and only if <span class="parameter">cursor</span> is located at the beginning of the line to which <span class="parameter">cursor</span> is attached.</p><p><span class="parameter">cursor</span> has to be attached to a line.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur.</p><p>A default method which is specialized to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> exists.  Simple implementations of the cursor protocol can therefore forego defining a method on this generic function.  More sophisticated implementations might use a more optimized way of determining whether <span class="parameter">cursor</span> is at the beginning of the line.</p></div><a id="function-end-of-line-p-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">end-of-line-p [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return <span class="explicit-italic">true</span> if and only if <span class="parameter">cursor</span> is located at the end of the line to which <span class="parameter">cursor</span> is attached.</p><p><span class="parameter">cursor</span> has to be attached to a line.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur.</p><p>A default method which is specialized to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> exists.  Simple implementations of the cursor protocol can therefore forego defining a method on this generic function.  More sophisticated implementations might use a more optimized way of determining whether <span class="parameter">cursor</span> is at the end of the line.</p></div><a id="function-beginning-of-buffer-p-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">beginning-of-buffer-p [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return <span class="explicit-italic">true</span> if and only if <span class="parameter">cursor</span> is located at the end of the buffer to which <span class="parameter">cursor</span> is indirectly attached.</p><p><span class="parameter">cursor</span> has to be attached to a line.  That line has to be attached to a buffer.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p><p>A default method which is specialized to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> exists.  Simple implementations of the cursor protocol can therefore forego defining a method on this generic function.  More sophisticated implementations might use a more optimized way of determining whether <span class="parameter">cursor</span> is at the beginning of the buffer.</p></div><a id="function-end-of-buffer-p-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">end-of-buffer-p [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p><span class="parameter">cursor</span> has to be attached to a line.  That line has to be attached to a buffer.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p><p>A default method which is specialized to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> exists.  Simple implementations of the cursor protocol can therefore forego defining a method on this generic function.  More sophisticated implementations might use a more optimized way of determining whether <span class="parameter">cursor</span> is at the end of the buffer.</p></div></section><section id="3.4.3-cursor-movement"><h4 class="section-title">3.4.3 Cursor Movement</h4><a id="function-backward-item-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">backward-item [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Move <span class="parameter">cursor</span> backward by one.</p><p>TODO return value</p><p><span class="parameter">cursor</span> has to be attached to a line.  <span class="parameter">cursor</span> must not be positioned at the beginning of the line it is attached to.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p><p>A default method which is specialized to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> and simply decrement the <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|index"><span class="explicit-mono">second-cluffer.implementation:index</span></a> of <span class="parameter">cursor</span> exists.</p></div><a id="function-forward-item-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">forward-item [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Move <span class="parameter">cursor</span> forward by one.</p><p>TODO return value</p><p><span class="parameter">cursor</span> has to be attached to a line.  <span class="parameter">cursor</span> must not be positioned at the end of the line it is attached to.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p><p>A default method which is specialized to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> and simply increments the <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|index"><span class="explicit-mono">second-cluffer.implementation:index</span></a> of <span class="parameter">cursor</span> exists.</p></div><a id="function-beginning-of-line-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">beginning-of-line [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Move <span class="parameter">cursor</span> to the beginning of the line it is attached to.</p><p><span class="parameter">cursor</span> has to be attached to a line. This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur..</p><p>A default method which is specialized to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> and simply sets the <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|index"><span class="explicit-mono">second-cluffer.implementation:index</span></a> of <span class="parameter">cursor</span> to <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>0</mo></math> exists.</p></div><a id="function-end-of-line-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">end-of-line [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Move <span class="parameter">cursor</span> to the end of the line it is attached to.</p><p><span class="parameter">cursor</span> has to be attached to a line.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur..</p><p>A default method which is specialized to <a class="nil-reference" href="#*-class-second-cluffer|cursor"><span class="explicit-mono">second-cluffer:cursor</span></a> and simply sets the <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|index"><span class="explicit-mono">second-cluffer.implementation:index</span></a> of <span class="parameter">cursor</span> to the <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|item-count"><span class="explicit-mono">second-cluffer.implementation:item-count</span></a> of the line exists.</p></div></section><section id="3.4.4-cursor-items"><h4 class="section-title">3.4.4 Cursor Items</h4><a id="*-generic-function-second-cluffer.implementation|item-before"> </a><a id="function-item-before-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">item-before [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/><p>Return the item located immediately before <span class="parameter">cursor</span>.</p><p><span class="parameter">cursor</span> has to be attached to a line..</p></div><a id="*-generic-function-second-cluffer.implementation|item-after"> </a><a id="function-item-after-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">item-after [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/></div><a id="function-insert-item-at-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">insert-item-at [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span>&nbsp;<span class="parameter">item</span><br/></div><a id="*-generic-function-second-cluffer.implementation|delete-item-before"> </a><a id="function-delete-item-before-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">delete-item-before [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/></div><a id="*-generic-function-second-cluffer.implementation|delete-item-after"> </a><a id="function-delete-item-after-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">delete-item-after [second-cluffer.implementation]</span>&nbsp;<span class="parameter">cursor</span><br/></div></section></section><section id="3.5-line-implementation-protocol"><h3 class="section-title">3.5 Line Implementation Protocol</h3><a id="function-dock-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">dock [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span><br/></div><a id="function-(setf-dock)-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">(setf dock) [second-cluffer.implementation]</span>&nbsp;<span class="parameter">new-value</span>&nbsp;<span class="parameter">line</span><br/></div><a id="function-first-line-p-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">first-line-p [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span><br/></div><a id="function-last-line-p-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">last-line-p [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span><br/></div><a id="*-generic-function-second-cluffer.implementation|cursors"> </a><a id="function-cursors-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">cursors [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span><br/><p>Return a list of the cursors attached to <span class="parameter">line</span>.</p><p>The order of cursor objects in the returned list is unspecified. Furthermore, the returned list may be destructively modified by a subsequent operation on a related cursor, line or buffer object.</p></div><a id="*-generic-function-second-cluffer.implementation|item"> </a><a id="function-item-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">item [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span><br/></div><a id="*-generic-function-second-cluffer.implementation|insert-item"> </a><a id="function-insert-item-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">insert-item [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span>&nbsp;<span class="parameter">item</span><br/></div><a id="*-generic-function-second-cluffer.implementation|delete-item"> </a><a id="function-delete-item-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">delete-item [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span><br/></div><a id="*-generic-function-second-cluffer.implementation|split"> </a><a id="function-split-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">split [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span><br/><p>Split <span class="parameter">line</span> at <span class="parameter">index</span> into two lines, <span class="parameter">line</span> and a newly created line which is returned.</p><p><a id="concept-stickiness-12"> </a><a id="concept-left-sticky-4"> </a><a id="concept-right-sticky-9"> </a><span class="parameter">line</span> contains the items and cursors preceding <span class="parameter">index</span> and the newly created and returned line contains the items and cursors following <span class="parameter">index</span>.  For cursors the index of which is <span class="parameter">index</span>, whether <span class="parameter">line</span> or the new line will contain the cursor depends on the stickiness of the cursor: if the cursor is left-sticky, it will be contained by <span class="parameter">line</span>, if the cursor is right-sticky, it will be contained by the new line.</p><p>Note that this function takes care only of creating the new line as well as transferring items and cursors.  Any changes to the arrangement of lines within a buffer are handled by <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|split-using-buffer"><span class="explicit-mono">second-cluffer.implementation:split-using-buffer</span></a> which typically calls this function.</p><p>To create the new line, the method on this generic function specialized to <a class="nil-reference" href="#*-class-second-cluffer.standard-line|line"><span class="explicit-mono">second-cluffer.standard-line:line</span></a>, calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|make-line-like"><span class="explicit-mono">second-cluffer.implementation:make-line-like</span></a> with the keyword arguments <code>:contents</code>, <code>:first-line-p</code> and <code>:last-line-p</code>.  The method on this generic function specialized to <a class="nil-reference" href="#*-class-second-cluffer.simple-line|line"><span class="explicit-mono">second-cluffer.simple-line:line</span></a>, calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|make-line-like"><span class="explicit-mono">second-cluffer.implementation:make-line-like</span></a> with the keyword argument <code>:contents</code>.</p></div><a id="*-generic-function-second-cluffer.implementation|join"> </a><a id="function-join-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">join [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line1</span>&nbsp;<span class="parameter">line2</span><br/><p>Join <span class="parameter">line1</span> with <span class="parameter">line2</span> and return the single remaining line.</p><p>Items and cursors from <span class="parameter">line2</span> are transferred to <span class="parameter">line1</span>.  Note that this function takes care only of items and cursors.  Any changes to the arrangement of lines within a buffer are handled by <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|join-using-buffer"><span class="explicit-mono">second-cluffer.implementation:join-using-buffer</span></a> which typically calls this function.</p></div><a id="*-generic-function-second-cluffer.implementation|make-line-like"> </a><a id="function-make-line-like-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">make-line-like [second-cluffer.implementation]</span>&nbsp;<span class="parameter">line</span>&nbsp;<code>&amp;key</code>&nbsp;<span class="parameter">contents</span>&nbsp;<span class="parameter">first-line-p</span>&nbsp;<span class="parameter">last-line-p</span>&nbsp;<code>&amp;allow-other-keys</code><br/><p>Make and return a new line object similar to <span class="parameter">line</span>.</p><p>The purpose of this function is to allow clients to use custom subclasses of the line classes provided by second-cluffer.  To this end, the function <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|split"><span class="explicit-mono">second-cluffer.implementation:split</span></a> calls this function when splitting a given line by creating a similar line object, also retaining the original line object and then distributing items and cursors between the two lines.  Since the client can supply an initial line of any class when a buffer is created and control the class of lines added by splitting, the client has control over the creation of all line objects without having to interfere with the respective <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|split"><span class="explicit-mono">second-cluffer.implementation:split</span></a> method.</p><p>The keyword arguments accepted by this function depend on the class of <span class="parameter">line</span>.  When <span class="parameter">line</span> is a <a class="nil-reference" href="#*-class-second-cluffer.standard-line|line"><span class="explicit-mono">second-cluffer.standard-line:line</span></a>, the default method on <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|split"><span class="explicit-mono">second-cluffer.implementation:split</span></a> calls this function with the keyword arguments <code>:contents</code>, <code>:first-line-p</code> and <code>:last-line-p</code>.  When <span class="parameter">line</span> is a <a class="nil-reference" href="#*-class-second-cluffer.simple-line|line"><span class="explicit-mono">second-cluffer.simple-line:line</span></a>, the default method on <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|split"><span class="explicit-mono">second-cluffer.implementation:split</span></a> calls this function with the keyword argument <code>:contents</code>.  For a custom line class with an associated custom method on <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|split"><span class="explicit-mono">second-cluffer.implementation:split</span></a>, a different set of keyword arguments may be supplied and accepted.  In general, methods on this generic function should accept the same set of initargs as is accepted by the respective line class and call <a href="https://novaspec.org/cl/f_make-instance"><span class="explicit-mono">cl:make-instance</span></a> with the provided initargs.</p></div></section><section id="3.6-dock-protocol"><h3 class="section-title">3.6 Dock Protocol</h3><a id="function-note-line-changed-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">note-line-changed [second-cluffer.implementation]</span>&nbsp;<span class="parameter">node</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">item-count-diff</span><br/></div></section><section id="3.7-buffer-implementation-protocol"><h3 class="section-title">3.7 Buffer Implementation Protocol</h3><a id="function-line-count-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">line-count [second-cluffer.implementation]</span>&nbsp;<span class="parameter">buffer</span><br/><p>Return the number of lines in <span class="parameter">buffer</span>.</p></div><a id="function-find-line-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">find-line [second-cluffer.implementation]</span>&nbsp;<span class="parameter">buffer</span>&nbsp;<span class="parameter">line-number</span><br/><p>Return the line with line number <span class="parameter">line-number</span> in <span class="parameter">buffer</span>.</p><p><span class="parameter">line-number</span> must not be negative and has to be smaller than the number of lines in <span class="parameter">buffer</span>.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur.</p></div><a id="function-line-number-using-buffer-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">line-number-using-buffer [second-cluffer.implementation]</span>&nbsp;<span class="parameter">buffer</span>&nbsp;<span class="parameter">dock</span>&nbsp;<span class="parameter">line</span><br/><p>Return the line number of <span class="parameter">line</span> within <span class="parameter">buffer</span>.</p><p><span class="parameter">line</span> has to be attached to a buffer.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur.</p></div><a id="*-generic-function-second-cluffer.implementation|split-using-buffer"> </a><a id="function-split-using-buffer-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">split-using-buffer [second-cluffer.implementation]</span>&nbsp;<span class="parameter">buffer</span>&nbsp;<span class="parameter">dock</span>&nbsp;<span class="parameter">line</span>&nbsp;<span class="parameter">index</span><br/><p>Split <span class="parameter">line</span> at <span class="parameter">index</span> into two lines, one of which is newly created and return the newly created line.</p><p>The first line contains the items and cursors preceding <span class="parameter">index</span> and the second line contains the items and cursors following <span class="parameter">index</span>.</p><p><span class="parameter">line</span> has to be attached to a buffer.  This precondition is not checked. If this precondition is violated, incorrect behavior or errors may occur.</p></div><a id="*-generic-function-second-cluffer.implementation|join-using-buffer"> </a><a id="function-join-using-buffer-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">join-using-buffer [second-cluffer.implementation]</span>&nbsp;<span class="parameter">buffer</span>&nbsp;<span class="parameter">dock</span>&nbsp;<span class="parameter">line</span><br/><p>Join <span class="parameter">line</span> with the line following it in <span class="parameter">buffer</span> which we will call <span class="parameter">next-line</span> and return the single remaining line.</p><p>This function normally calls <a class="nil-reference" href="#*-generic-function-second-cluffer.implementation|join"><span class="explicit-mono">second-cluffer.implementation:join</span></a> with <span class="parameter">line</span> and <span class="parameter">next-line</span> to transfer items and cursors from <span class="parameter">next-line</span> to <span class="parameter">line</span>. <span class="parameter">next-line</span> becomes detached from <span class="parameter">buffer</span>.</p><p><span class="parameter">line</span> has to be attached to a buffer.  <span class="parameter">line</span> must not be the last line of <span class="parameter">buffer</span>.  These preconditions are not checked.  If these preconditions are violated, incorrect behavior or errors may</p></div></section><section id="3.8-update-implementation-protocol"><h3 class="section-title">3.8 Update Implementation protocol</h3><p> <a id="function-update-[second-cluffer.implementation]"> </a><div class="component"><span class="kind">function</span><span class="name">update [second-cluffer.implementation]</span>&nbsp;<span class="parameter">buffer</span>&nbsp;<span class="parameter">time</span>&nbsp;<span class="parameter">sync</span>&nbsp;<span class="parameter">skip</span>&nbsp;<span class="parameter">modify</span>&nbsp;<span class="parameter">create</span><br/></div></p></section></section><section id="4-implementations"><h2 class="section-title">4 Implementations</h2><p> second-cluffer includes two modules each of which contains an implementation of all relevant protocols.  However, the two modules are optimized for different purposes:</p><ol start="1" style="list-style: decimal;"><li><p>The <a class="nil-reference" href="#4.1-simple-implementation">``simple'' module</a> contains an implementation that is, as the name suggests, optimized for simplicity of its data structures, algorithms and code without any performance considerations.  This module serves mainly as a reference in the sense that the behavior of other implementations can be compared to this baseline, for example in randomized tests.</p></li><li><p>The <a class="nil-reference" href="#4.2-standard-implementation">``standard'' module</a> contains an implementation that is optimized for high performance in most usage scenarios.  To this end, the module employs more complicated data structures, caches and optimized code.</p></li></ol><p>Clients of second-cluffer should generally use the standard implementation since it provides consistent performance across most usage scenarios without exposing clients to the internal complexity.  This is why the convenience function <a class="nil-reference" href="#*-function-second-cluffer|make-empty-buffer"><span class="explicit-mono">second-cluffer:make-empty-buffer</span></a> by default creates and returns a <a class="nil-reference" href="#*-class-second-cluffer.standard-buffer|buffer"><span class="explicit-mono">second-cluffer.standard-buffer:buffer</span></a> which is set up to contain instances of <a class="nil-reference" href="#*-class-second-cluffer.standard-line|line"><span class="explicit-mono">second-cluffer.standard-line:line</span></a>.</p><section id="4.1-simple-implementation"><h3 class="section-title">4.1 Simple Implementation</h3><p>The ``simple'' implementation is distributed across two packages: <span class="explicit-mono">second-cluffer.simple-line</span> and <span class="explicit-mono">second-cluffer.simple-buffer</span>.  While the two packages are intended to be used together, it is possible to use only one of those and use a different implementation for the remaining aspects.</p><a id="*-class-second-cluffer.simple-line|line"> </a><a id="type-line-[second-cluffer.simple-line]"> </a><div class="component"><span class="kind">type</span><span class="name">line [second-cluffer.simple-line]</span><br/></div><a id="concept-left-sticky-5"> </a><a id="type-left-sticky-cursor-[second-cluffer.simple-line]"> </a><div class="component"><span class="kind">type</span><span class="name">left-sticky-cursor [second-cluffer.simple-line]</span><br/><p>A left-sticky cursor that works with instances of <a class="nil-reference" href="#*-class-second-cluffer.simple-line|line"><span class="explicit-mono">second-cluffer.simple-line:line</span></a>.</p></div><a id="concept-right-sticky-10"> </a><a id="type-right-sticky-cursor-[second-cluffer.simple-line]"> </a><div class="component"><span class="kind">type</span><span class="name">right-sticky-cursor [second-cluffer.simple-line]</span><br/><p>A right-sticky cursor that works with instances of <a class="nil-reference" href="#*-class-second-cluffer.simple-line|line"><span class="explicit-mono">second-cluffer.simple-line:line</span></a>.</p></div><a id="type-buffer-[second-cluffer.simple-buffer]"> </a><div class="component"><span class="kind">type</span><span class="name">buffer [second-cluffer.simple-buffer]</span><br/><p>TODO</p></div></section><section id="4.2-standard-implementation"><h3 class="section-title">4.2 Standard Implementation</h3><p>The ``standard'' implementation is distributed across two packages: <span class="explicit-mono">second-cluffer.standard-line</span> and <span class="explicit-mono">second-cluffer.standard-buffer</span>.  While the two packages are intended to be used together, it is possible to use only one of those and use a different implementation for the remaining aspects.</p><p><a id="*-class-second-cluffer.standard-line|line"> </a> <a id="type-line-[second-cluffer.standard-line]"> </a><div class="component"><span class="kind">type</span><span class="name">line [second-cluffer.standard-line]</span><br/></div> <a id="concept-left-sticky-6"> </a><a id="*-class-second-cluffer.standard-line|left-sticky-cursor"> </a> <a id="type-left-sticky-cursor-[second-cluffer.standard-line]"> </a><div class="component"><span class="kind">type</span><span class="name">left-sticky-cursor [second-cluffer.standard-line]</span><br/><p>A left-sticky cursor that works with instances of <a class="nil-reference" href="#*-class-second-cluffer.standard-line|line"><span class="explicit-mono">second-cluffer.standard-line:line</span></a>.</p></div> <a id="concept-right-sticky-11"> </a><a id="*-class-second-cluffer.standard-line|right-sticky-cursor"> </a> <a id="type-right-sticky-cursor-[second-cluffer.standard-line]"> </a><div class="component"><span class="kind">type</span><span class="name">right-sticky-cursor [second-cluffer.standard-line]</span><br/><p>A right-sticky cursor that works with instances of <a class="nil-reference" href="#*-class-second-cluffer.standard-line|line"><span class="explicit-mono">second-cluffer.standard-line:line</span></a>.</p></div> <a id="*-class-second-cluffer.standard-buffer|buffer"> </a> <a id="type-buffer-[second-cluffer.standard-buffer]"> </a><div class="component"><span class="kind">type</span><span class="name">buffer [second-cluffer.standard-buffer]</span><br/><p>TODO</p><p>The simplest way to create a correctly configured instance of this class is the convenience function <a class="nil-reference" href="#*-function-second-cluffer|make-empty-buffer"><span class="explicit-mono">second-cluffer:make-empty-buffer</span></a>.</p></div></p></section></section><section id="concept-index"><h2 class="section-title">Concept Index</h2><dl><dt>left-sticky</dt><dd><ul><li><a class="nil-reference" href="#concept-left-sticky">First occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></li><li><a class="nil-reference" href="#concept-left-sticky-2">Second occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></li><li><a class="nil-reference" href="#concept-left-sticky-3">Third occurence</a> in section <a class="section-reference" href="#3.4-cursor-implementation-protocol">3.4 Cursor Implementation Protocol</a></li><li><a class="nil-reference" href="#concept-left-sticky-4">Fourth occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></li><li><a class="nil-reference" href="#concept-left-sticky-5">Fifth occurence</a> in section <a class="section-reference" href="#4.1-simple-implementation">4.1 Simple Implementation</a></li><li><a class="nil-reference" href="#concept-left-sticky-6">Sixth occurence</a> in section <a class="section-reference" href="#4.2-standard-implementation">4.2 Standard Implementation</a></li></ul></dd><dt>right-sticky</dt><dd><ul><li><a class="nil-reference" href="#concept-right-sticky">First occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></li><li><a class="nil-reference" href="#concept-right-sticky-7">Second occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></li><li><a class="nil-reference" href="#concept-right-sticky-8">Third occurence</a> in section <a class="section-reference" href="#3.4-cursor-implementation-protocol">3.4 Cursor Implementation Protocol</a></li><li><a class="nil-reference" href="#concept-right-sticky-9">Fourth occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></li><li><a class="nil-reference" href="#concept-right-sticky-10">Fifth occurence</a> in section <a class="section-reference" href="#4.1-simple-implementation">4.1 Simple Implementation</a></li><li><a class="nil-reference" href="#concept-right-sticky-11">Sixth occurence</a> in section <a class="section-reference" href="#4.2-standard-implementation">4.2 Standard Implementation</a></li></ul></dd><dt>stickiness</dt><dd><ul><li><a class="nil-reference" href="#concept-stickiness">First occurence</a> in section <a class="section-reference" href="#3.4-cursor-implementation-protocol">3.4 Cursor Implementation Protocol</a></li><li><a class="nil-reference" href="#concept-stickiness-12">Second occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></li></ul></dd><dt>time stamp</dt><dd><a class="nil-reference" href="#concept-time-stamp">One occurence</a> in section <a class="section-reference" href="#2.12-update-protocol">2.12 Update Protocol</a></dd></dl></section><section id="function-and-macro-and-variable-and-type-index"><h2 class="section-title">Function and Macro and Variable and Type Index</h2><dl><dt>(setf dock) [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-(setf-dock)-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>(setf index) [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-(setf-index)-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.2-cursor-location">3.4.2 Cursor Location</a></dd><dt>(setf index) [second-cluffer]</dt><dd><a class="nil-reference" href="#function-(setf-index)-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.2-cursor-location">2.9.2 Cursor Location</a></dd><dt>attach [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-attach-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.1-cursor-attachment">3.4.1 Cursor Attachment</a></dd><dt>attach [second-cluffer]</dt><dd><a class="nil-reference" href="#function-attach-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.1-cursor-attachment">2.9.1 Cursor Attachment</a></dd><dt>attachedp [second-cluffer]</dt><dd><a class="nil-reference" href="#function-attachedp-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.1-cursor-attachment">2.9.1 Cursor Attachment</a></dd><dt>backward-item [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-backward-item-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.3-cursor-movement">3.4.3 Cursor Movement</a></dd><dt>backward-item [second-cluffer]</dt><dd><a class="nil-reference" href="#function-backward-item-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.3-cursor-movement">2.9.3 Cursor Movement</a></dd><dt>beginning-of-buffer-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-beginning-of-buffer-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>beginning-of-buffer-p [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-beginning-of-buffer-p-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.2-cursor-location">3.4.2 Cursor Location</a></dd><dt>beginning-of-buffer-p [second-cluffer]</dt><dd><a class="nil-reference" href="#function-beginning-of-buffer-p-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.2-cursor-location">2.9.2 Cursor Location</a></dd><dt>beginning-of-line [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-beginning-of-line-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.3-cursor-movement">3.4.3 Cursor Movement</a></dd><dt>beginning-of-line [second-cluffer]</dt><dd><a class="nil-reference" href="#function-beginning-of-line-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.3-cursor-movement">2.9.3 Cursor Movement</a></dd><dt>beginning-of-line-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-beginning-of-line-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>beginning-of-line-p [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-beginning-of-line-p-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.2-cursor-location">3.4.2 Cursor Location</a></dd><dt>beginning-of-line-p [second-cluffer]</dt><dd><a class="nil-reference" href="#function-beginning-of-line-p-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.2-cursor-location">2.9.2 Cursor Location</a></dd><dt>buffer [second-cluffer.simple-buffer]</dt><dd><a class="nil-reference" href="#type-buffer-[second-cluffer.simple-buffer]">One occurence</a> in section <a class="section-reference" href="#4.1-simple-implementation">4.1 Simple Implementation</a></dd><dt>buffer [second-cluffer.standard-buffer]</dt><dd><a class="nil-reference" href="#type-buffer-[second-cluffer.standard-buffer]">One occurence</a> in section <a class="section-reference" href="#4.2-standard-implementation">4.2 Standard Implementation</a></dd><dt>buffer [second-cluffer]</dt><dd><ul><li><a class="nil-reference" href="#type-buffer-[second-cluffer]">First occurence</a> in section <a class="section-reference" href="#2.3-protocol-classes">2.3 Protocol Classes</a></li><li><a class="nil-reference" href="#function-buffer-[second-cluffer]">Second occurence</a> in section <a class="section-reference" href="#2.8-buffer-link-protocol">2.8 Buffer Link Protocol</a></li></ul></dd><dt>cluffer-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-cluffer-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>cursor [second-cluffer]</dt><dd><a class="nil-reference" href="#type-cursor-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.3-protocol-classes">2.3 Protocol Classes</a></dd><dt>cursor-attached-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-cursor-attached-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>cursor-detached-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-cursor-detached-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>cursors [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-cursors-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>cursors [second-cluffer]</dt><dd><a class="nil-reference" href="#function-cursors-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></dd><dt>cursors-not-comparable-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-cursors-not-comparable-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>delete-item [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-delete-item-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>delete-item [second-cluffer]</dt><dd><a class="nil-reference" href="#function-delete-item-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></dd><dt>delete-item-after [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-delete-item-after-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.4-cursor-items">3.4.4 Cursor Items</a></dd><dt>delete-item-after [second-cluffer]</dt><dd><a class="nil-reference" href="#function-delete-item-after-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.4-cursor-items">2.9.4 Cursor Items</a></dd><dt>delete-item-before [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-delete-item-before-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.4-cursor-items">3.4.4 Cursor Items</a></dd><dt>delete-item-before [second-cluffer]</dt><dd><a class="nil-reference" href="#function-delete-item-before-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.4-cursor-items">2.9.4 Cursor Items</a></dd><dt>detach [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-detach-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.1-cursor-attachment">3.4.1 Cursor Attachment</a></dd><dt>detach [second-cluffer]</dt><dd><a class="nil-reference" href="#function-detach-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.1-cursor-attachment">2.9.1 Cursor Attachment</a></dd><dt>dock [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-dock-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>end-of-buffer-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-end-of-buffer-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>end-of-buffer-p [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-end-of-buffer-p-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.2-cursor-location">3.4.2 Cursor Location</a></dd><dt>end-of-buffer-p [second-cluffer]</dt><dd><a class="nil-reference" href="#function-end-of-buffer-p-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.2-cursor-location">2.9.2 Cursor Location</a></dd><dt>end-of-line [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-end-of-line-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.3-cursor-movement">3.4.3 Cursor Movement</a></dd><dt>end-of-line [second-cluffer]</dt><dd><a class="nil-reference" href="#function-end-of-line-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.3-cursor-movement">2.9.3 Cursor Movement</a></dd><dt>end-of-line-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-end-of-line-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>end-of-line-p [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-end-of-line-p-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.2-cursor-location">3.4.2 Cursor Location</a></dd><dt>end-of-line-p [second-cluffer]</dt><dd><a class="nil-reference" href="#function-end-of-line-p-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.2-cursor-location">2.9.2 Cursor Location</a></dd><dt>find-line [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-find-line-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.7-buffer-implementation-protocol">3.7 Buffer Implementation Protocol</a></dd><dt>find-line [second-cluffer]</dt><dd><a class="nil-reference" href="#function-find-line-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.11-buffer-protocol">2.11 Buffer Protocol</a></dd><dt>first-line-p [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-first-line-p-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>first-line-p [second-cluffer]</dt><dd><a class="nil-reference" href="#function-first-line-p-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></dd><dt>forward-item [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-forward-item-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.3-cursor-movement">3.4.3 Cursor Movement</a></dd><dt>forward-item [second-cluffer]</dt><dd><a class="nil-reference" href="#function-forward-item-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.3-cursor-movement">2.9.3 Cursor Movement</a></dd><dt>index [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-index-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.2-cursor-location">3.4.2 Cursor Location</a></dd><dt>index [second-cluffer]</dt><dd><a class="nil-reference" href="#function-index-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.2-cursor-location">2.9.2 Cursor Location</a></dd><dt>insert-item [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-insert-item-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>insert-item [second-cluffer]</dt><dd><a class="nil-reference" href="#function-insert-item-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></dd><dt>insert-item-at [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-insert-item-at-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.4-cursor-items">3.4.4 Cursor Items</a></dd><dt>insert-item-at [second-cluffer]</dt><dd><a class="nil-reference" href="#function-insert-item-at-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.4-cursor-items">2.9.4 Cursor Items</a></dd><dt>item [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-item-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>item [second-cluffer]</dt><dd><a class="nil-reference" href="#function-item-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></dd><dt>item-after [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-item-after-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.4-cursor-items">3.4.4 Cursor Items</a></dd><dt>item-after [second-cluffer]</dt><dd><a class="nil-reference" href="#function-item-after-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.4-cursor-items">2.9.4 Cursor Items</a></dd><dt>item-before [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-item-before-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.4.4-cursor-items">3.4.4 Cursor Items</a></dd><dt>item-before [second-cluffer]</dt><dd><a class="nil-reference" href="#function-item-before-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.4-cursor-items">2.9.4 Cursor Items</a></dd><dt>item-count [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-item-count-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.2-item-container-implementation-protocol">3.2 Item Container Implementation Protocol</a></dd><dt>item-count [second-cluffer]</dt><dd><a class="nil-reference" href="#function-item-count-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.5-item-container-protocol">2.5 Item Container Protocol</a></dd><dt>items [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-items-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.2-item-container-implementation-protocol">3.2 Item Container Implementation Protocol</a></dd><dt>items [second-cluffer]</dt><dd><a class="nil-reference" href="#function-items-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.5-item-container-protocol">2.5 Item Container Protocol</a></dd><dt>join [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-join-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>join [second-cluffer]</dt><dd><a class="nil-reference" href="#function-join-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></dd><dt>join-line [second-cluffer]</dt><dd><a class="nil-reference" href="#function-join-line-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.4-cursor-items">2.9.4 Cursor Items</a></dd><dt>join-using-buffer [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-join-using-buffer-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.7-buffer-implementation-protocol">3.7 Buffer Implementation Protocol</a></dd><dt>last-line-p [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-last-line-p-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>last-line-p [second-cluffer]</dt><dd><a class="nil-reference" href="#function-last-line-p-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></dd><dt>left-sticky-cursor [second-cluffer.simple-line]</dt><dd><a class="nil-reference" href="#type-left-sticky-cursor-[second-cluffer.simple-line]">One occurence</a> in section <a class="section-reference" href="#4.1-simple-implementation">4.1 Simple Implementation</a></dd><dt>left-sticky-cursor [second-cluffer.standard-line]</dt><dd><a class="nil-reference" href="#type-left-sticky-cursor-[second-cluffer.standard-line]">One occurence</a> in section <a class="section-reference" href="#4.2-standard-implementation">4.2 Standard Implementation</a></dd><dt>line [second-cluffer.simple-line]</dt><dd><a class="nil-reference" href="#type-line-[second-cluffer.simple-line]">One occurence</a> in section <a class="section-reference" href="#4.1-simple-implementation">4.1 Simple Implementation</a></dd><dt>line [second-cluffer.standard-line]</dt><dd><a class="nil-reference" href="#type-line-[second-cluffer.standard-line]">One occurence</a> in section <a class="section-reference" href="#4.2-standard-implementation">4.2 Standard Implementation</a></dd><dt>line [second-cluffer]</dt><dd><ul><li><a class="nil-reference" href="#type-line-[second-cluffer]">First occurence</a> in section <a class="section-reference" href="#2.3-protocol-classes">2.3 Protocol Classes</a></li><li><a class="nil-reference" href="#function-line-[second-cluffer]">Second occurence</a> in section <a class="section-reference" href="#2.7-line-link-protocol">2.7 Line Link Protocol</a></li></ul></dd><dt>line-count [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-line-count-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.7-buffer-implementation-protocol">3.7 Buffer Implementation Protocol</a></dd><dt>line-count [second-cluffer]</dt><dd><a class="nil-reference" href="#function-line-count-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.11-buffer-protocol">2.11 Buffer Protocol</a></dd><dt>line-detached-error [second-cluffer]</dt><dd><a class="nil-reference" href="#type-line-detached-error-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.2-conditions">2.2 Conditions</a></dd><dt>line-number [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-line-number-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.3-line-number-implementation-protocol">3.3 Line Number Implementation Protocol</a></dd><dt>line-number [second-cluffer]</dt><dd><a class="nil-reference" href="#function-line-number-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.6-line-number-protocol">2.6 Line Number Protocol</a></dd><dt>line-number-using-buffer [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-line-number-using-buffer-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.7-buffer-implementation-protocol">3.7 Buffer Implementation Protocol</a></dd><dt>location/= [second-cluffer]</dt><dd><a class="nil-reference" href="#function-location/=-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.4-location-comparison-protocol">2.4 Location Comparison Protocol</a></dd><dt>location&lt; [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-location&lt;-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.1-location-comparison-implementation-protocol">3.1 Location Comparison Implementation Protocol</a></dd><dt>location&lt; [second-cluffer]</dt><dd><a class="nil-reference" href="#function-location&lt;-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.4-location-comparison-protocol">2.4 Location Comparison Protocol</a></dd><dt>location&lt;= [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-location&lt;=-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.1-location-comparison-implementation-protocol">3.1 Location Comparison Implementation Protocol</a></dd><dt>location&lt;= [second-cluffer]</dt><dd><a class="nil-reference" href="#function-location&lt;=-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.4-location-comparison-protocol">2.4 Location Comparison Protocol</a></dd><dt>location= [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-location=-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.1-location-comparison-implementation-protocol">3.1 Location Comparison Implementation Protocol</a></dd><dt>location= [second-cluffer]</dt><dd><a class="nil-reference" href="#function-location=-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.4-location-comparison-protocol">2.4 Location Comparison Protocol</a></dd><dt>location&gt; [second-cluffer]</dt><dd><a class="nil-reference" href="#function-location&gt;-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.4-location-comparison-protocol">2.4 Location Comparison Protocol</a></dd><dt>location&gt;= [second-cluffer]</dt><dd><a class="nil-reference" href="#function-location&gt;=-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.4-location-comparison-protocol">2.4 Location Comparison Protocol</a></dd><dt>make-empty-buffer [second-cluffer]</dt><dd><a class="nil-reference" href="#function-make-empty-buffer-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.13-convenience-functions">2.13 Convenience Functions</a></dd><dt>make-line-like [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-make-line-like-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>note-line-changed [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-note-line-changed-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.6-dock-protocol">3.6 Dock Protocol</a></dd><dt>right-sticky-cursor [second-cluffer.simple-line]</dt><dd><a class="nil-reference" href="#type-right-sticky-cursor-[second-cluffer.simple-line]">One occurence</a> in section <a class="section-reference" href="#4.1-simple-implementation">4.1 Simple Implementation</a></dd><dt>right-sticky-cursor [second-cluffer.standard-line]</dt><dd><a class="nil-reference" href="#type-right-sticky-cursor-[second-cluffer.standard-line]">One occurence</a> in section <a class="section-reference" href="#4.2-standard-implementation">4.2 Standard Implementation</a></dd><dt>split [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-split-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.5-line-implementation-protocol">3.5 Line Implementation Protocol</a></dd><dt>split [second-cluffer]</dt><dd><a class="nil-reference" href="#function-split-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.10-line-protocol">2.10 Line Protocol</a></dd><dt>split-line [second-cluffer]</dt><dd><a class="nil-reference" href="#function-split-line-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.9.4-cursor-items">2.9.4 Cursor Items</a></dd><dt>split-using-buffer [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-split-using-buffer-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.7-buffer-implementation-protocol">3.7 Buffer Implementation Protocol</a></dd><dt>stickiness [second-cluffer]</dt><dd><a class="nil-reference" href="#function-stickiness-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#3.4-cursor-implementation-protocol">3.4 Cursor Implementation Protocol</a></dd><dt>update [second-cluffer.implementation]</dt><dd><a class="nil-reference" href="#function-update-[second-cluffer.implementation]">One occurence</a> in section <a class="section-reference" href="#3.8-update-implementation-protocol">3.8 Update Implementation protocol</a></dd><dt>update [second-cluffer]</dt><dd><a class="nil-reference" href="#function-update-[second-cluffer]">One occurence</a> in section <a class="section-reference" href="#2.12-update-protocol">2.12 Update Protocol</a></dd></dl></section><section id="changelog"><h2 class="section-title">Changelog</h2><p><section id="version-1.0"><h3 class="section-title">Version 1.0</h3>Hi</section></p><p/></section><section id="footnotes"><h2 class="section-title">Footnotes</h2><dl><dt id="text.document-schema.schema:definition-item-1"><a class="footnote-reference" href="#text.document-schema.schema:superscript-13">(1)</a></dt><dd>We may improve on this performance in the future.</dd></dl></section></div></main><footer>Copyright © 2025. Generated on 2025-11-07 14:22:52</footer></body></html>